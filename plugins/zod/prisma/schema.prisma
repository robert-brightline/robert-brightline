generator zod {
  provider = "zod"
  output   = "../tests/zod"
}

generator client {
  provider = "prisma-client"
  output   = "../tests/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Status {
  ACTIVE
  PASSIVE
}

enum Scope {
  APP
  Low
  High
}

model Category {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  name String @unique @db.VarChar(255)

  parent   Category? @relation("children", fields: [parentId], references: [id])
  parentId Int?

  children Category[] @relation("children")

  /// @internal
  products Product[]
}

model User {
  id        Int       @id @default(autoincrement())
  uuid      String    @default(uuid(7)) @db.Uuid
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  /// @email
  username String @unique

  /// @password
  password String

  /// @internal 
  updatedProducts Product[] @relation("Updater")

  /// @internal 
  createdProducts Product[] @relation("Creater")
}

model Tag {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  product   Product? @relation(fields: [productId], references: [id])
  productId Int?
}

model Product {
  id        Int       @id @default(autoincrement())
  uuid      String    @default(uuid(7)) @db.Uuid
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  name        String  @unique @db.VarChar(255)
  description String?

  ownTags String[]

  /// @upc
  upc String @unique

  /// @min(6) @max(13)
  sku String @unique

  attributes Json?

  quantity Int @default(0)

  price Decimal @default(0) @db.Decimal(8, 6)

  /// @lessThan(price)
  cost Decimal @default(0) @db.Decimal(8, 6)

  active Boolean?

  category   Category? @relation(fields: [categoryId], references: [id])
  categoryId Int?

  tags Tag[]

  /// @internal
  createdBy User? @relation("Creater", fields: [createdById], references: [id])

  /// @internal
  createdById Int?

  /// @internal
  updatedBy User? @relation("Updater", fields: [updatedById], references: [id])

  /// @internal
  updatedById Int?

  status Status

  scopes Scope[]
}
